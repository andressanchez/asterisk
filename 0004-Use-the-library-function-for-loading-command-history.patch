From ecc63fc573595b3dced950c32a7ad83e49c0325d Mon Sep 17 00:00:00 2001
From: Jeffrey C. Ollie <jeff@ocjtech.us>
Date: Mon, 8 Mar 2010 12:38:56 -0600
Subject: [PATCH 4/8] Use the library function for loading command history rather than implementing our own.

---
 main/asterisk.c |   21 ++-------------------
 1 files changed, 2 insertions(+), 19 deletions(-)

diff --git a/main/asterisk.c b/main/asterisk.c
index c51e8cc..dda3550 100644
--- a/main/asterisk.c
+++ b/main/asterisk.c
@@ -2596,29 +2596,12 @@ static int ast_el_write_history(char *filename)
 
 static int ast_el_read_history(char *filename)
 {
-	char buf[MAX_HISTORY_COMMAND_LENGTH];
-	FILE *f;
-	int ret = -1;
+	HistEvent ev;
 
 	if (el_hist == NULL || el == NULL)
 		ast_el_initialize();
 
-	if ((f = fopen(filename, "r")) == NULL)
-		return ret;
-
-	while (!feof(f)) {
-		if (!fgets(buf, sizeof(buf), f))
-			break;
-		if (!strcmp(buf, "_HiStOrY_V2_\n"))
-			continue;
-		if (ast_all_zeros(buf))
-			continue;
-		if ((ret = ast_el_add_history(buf)) == -1)
-			break;
-	}
-	fclose(f);
-
-	return ret;
+	return (history(el_hist, &ev, H_LOAD, filename));
 }
 
 static void ast_remotecontrol(char *data)
-- 
1.7.2.1

