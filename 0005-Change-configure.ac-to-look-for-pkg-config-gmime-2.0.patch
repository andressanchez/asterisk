From eae426c0f00ac1889de8ce0a539f73b6008b3d59 Mon Sep 17 00:00:00 2001
From: Jeffrey C. Ollie <jeff@ocjtech.us>
Date: Wed, 28 Jul 2010 07:26:02 -0500
Subject: [PATCH 5/8] Change configure.ac to look for pkg-config gmime-2.0

---
 configure.ac |   12 +++++++++++-
 1 files changed, 11 insertions(+), 1 deletions(-)

diff --git a/configure.ac b/configure.ac
index 584ec4c..2730ab2 100644
--- a/configure.ac
+++ b/configure.ac
@@ -1808,7 +1808,17 @@ fi
 
 AST_EXT_LIB_CHECK([SRTP], [srtp], [srtp_init], [srtp/srtp.h])
 
-AST_EXT_TOOL_CHECK([GMIME], [gmime-config], [], [], [#include <gmime/gmime.h>], [gboolean q = g_mime_check_version(0,0,0);])
+PBX_GMIME=0
+AC_CHECK_TOOL(PKGCONFIG, pkg-config, No)
+if test ! "x${PKGCONFIG}" = xNo; then
+   GMIME_INCLUDE=$(${PKGCONFIG} gmime-2.0 --cflags 2>/dev/null)
+   GMIME_LIB=$(${PKGCONFIG} gmime-2.0 --libs)
+   PBX_GMIME=1
+   AC_DEFINE([HAVE_GMIME], 1, [Define if your system has the GMIME libraries.])
+fi
+AC_SUBST(PBX_GMIME)
+AC_SUBST(GMIME_INCLUDE)
+AC_SUBST(GMIME_LIB)
 
 AST_EXT_LIB_CHECK([HOARD], [hoard], [malloc], [])
 
-- 
1.7.2.1

